"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const changeCase = require("change-case");
const DICT = {
    en: {
        required: 'The field :field is required.',
        number: 'The field :field must be a number.',
        string: 'The field :field must be a string.',
        boolean: 'The field :field must be a boolean.',
        in: 'The field :field must be one of the: :list.',
        maxStringLength: 'The field :field must be less than: :value.',
        maxNumberLength: 'The length of field :field must be less than: :value.',
        maxNumber: 'The field :field must be less than: :value.',
        date: 'The field :field must be a valid date format.',
        regex: 'The :field format is invalid.',
        requiredIf: 'The field :field is required when :dependField is not empty.',
        requiredIfNot: 'The field :field is required when :dependField is empty.',
    },
    ru: {
        required: 'Поле :field обязательно для заполнения.',
        number: 'Поле :field должно быть числом.',
        string: 'Поле :field должно быть строкой.',
        boolean: 'Поле :field должно быть true или false.',
        in: 'Поле :field должно входить в список: :list.',
        maxStringLength: 'Поле :field должно содерджать :value символов.',
        maxNumberLength: 'Число :field должно быть меньше :value.',
        maxNumber: 'Число :field должно быть меньше :value.',
        date: 'Неверный формат даты.',
        regex: 'Поле :field неверного формата.',
        requiredIf: 'Поле :field обязательно, если не пустое поле :dependField.',
        requiredIfNot: 'Поле :field обязательно, если пустое поле :dependField.',
    },
};
const FIELD_LIST_DICT = {
    ru: {
        phone_number: `'Номер телефона'`,
        index: `'Индекс'`,
        event: `'Событие'`,
        service: `''Сервис`,
        push_token: `'Пуш токен'`,
        embeded: `'Встроенное устройство'`,
        client_timestamp: `'Дата и время клиента'`,
        cert: `'Сертификат'`,
        name: `'Имя'`,
        uin: `'ИИН'`,
        code: `'Код'`,
        sex: `'Пол'`,
        email: `'Электронная почта'`,
        birthdate: `'День рождения'`,
        Region: `'Регион'`,
        personal_account: `'Лицевой счет'`,
        question: `'Вопрос'`,
        answer: `'Ответ'`,
        additional_data: `'Дополнительная информация'`,
        region: `'Регион'`,
        method: `'Метод'`,
    },
    en: {
        phone_number: `'Phone number'`,
        index: `'Index'`,
        event: `'Event'`,
        service: `''Service`,
        push_token: `'Push token'`,
        embeded: `'Embeded'`,
        client_timestamp: `'Client timestamp'`,
        cert: `'Certificate'`,
        name: `'Name'`,
        uin: `'Uin'`,
        code: `'Code'`,
        sex: `'Sex'`,
        email: `'Email'`,
        birthdate: `'Birthdate'`,
        Region: `'Region'`,
        personal_account: `'Personal account'`,
        question: `'Question'`,
        answer: `'Answer'`,
        additional_data: `'Additional data'`,
        method: `'Method'`,
        region: `'Region'`,
        remember: `'Remember'`,
    },
};
class Validator {
    constructor(data, rules, messages) {
        this.data = data;
        this.rules = rules;
        this.messages = messages;
        this.errors = {};
        this.dataTransformed = {};
        this.RULE_VALUE_DELIMITER = ',';
        this.RULE_VERSUS_VALUE_DELIMITER = ':';
        this.lang = 'en';
        this.RULES_DELIMITER = '|';
        const fieldsToHandle = Object.keys(this.data);
        for (let f of fieldsToHandle) {
            this.dataTransformed[changeCase.snakeCase(f)] = this.data[f];
        }
        if (['ru', 'en'].indexOf(this.data.lang) !== -1) {
            this.lang = this.data.lang || 'en';
        }
        else {
            this.lang = 'en';
        }
        Object.keys(this.rules).forEach(fieldNameToCheck => {
            const fieldRules = this.rules[fieldNameToCheck].split(this.RULES_DELIMITER);
            for (const rule of fieldRules) {
                try {
                    let splitted = rule.split(this.RULE_VERSUS_VALUE_DELIMITER);
                    if (splitted.length && splitted[0] === 'regex') {
                        this.checkRegex(fieldNameToCheck, new RegExp(splitted[1].slice(1, -1)));
                        continue;
                    }
                    if (splitted.length) {
                        const funcName = this.capitalizeFirstLetter(splitted.shift());
                        try {
                            this[`check${funcName}`](fieldNameToCheck, splitted);
                        }
                        catch (E) {
                            console.info(`Validator@constructor: validation error funcName `, funcName, fieldNameToCheck);
                        }
                        continue;
                    }
                    this['check' + this.capitalizeFirstLetter(splitted[0])](fieldNameToCheck);
                }
                catch (e) {
                    console.info(`Validator@constructor: validation type is not supported`, e);
                }
            }
        });
    }
    getErrors() {
        return this.errors;
    }
    isEmpty() {
        return Object.keys(this.errors).length === 0;
    }
    fails() {
        return !this.isEmpty();
    }
    addError(fieldName, checkType, data) {
        if (!this.errors[fieldName]) {
            this.errors[fieldName] = [];
        }
        let checkMessage;
        if (checkType && this.messages) {
            checkMessage = this.messages[`${fieldName}.${checkType}`];
        }
        this.errors[fieldName].push(checkMessage || this.getMessage(checkType, data));
    }
    checkRequired(field) {
        if (!this.dataTransformed[field] || this.dataTransformed[field] === '') {
            this.addError(field, 'required', { field: field });
        }
    }
    checkBoolean(field) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (typeof (this.dataTransformed[field]) !== typeof (true)) {
            this.addError(field, 'boolean', { field: field });
        }
    }
    fieldIsEmpty(field) {
        return this.dataTransformed[field] === undefined || this.dataTransformed[field] === '';
    }
    checkIn(field, list) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (list[0].split(this.RULE_VALUE_DELIMITER).indexOf(this.dataTransformed[field]) === -1) {
            this.addError(field, 'in', { field: field, list: list });
        }
    }
    checkMaxStringLength(field, value) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (this.dataTransformed[field].length >= parseInt(value, 10)) {
            this.addError(field, 'maxStringLength', { field: field, value: value });
        }
    }
    checkMaxNumber(field, value) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (parseInt(this.dataTransformed[field], 10) >= parseInt(value[0], 10)) {
            this.addError(field, 'maxNumber', { field: field, value: value });
        }
    }
    checkMaxNumberLength(field, value) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (`${this.dataTransformed[field]}`.length >= parseInt(value[0], 10)) {
            this.addError(field, 'maxNumberLength', { field: field, value: value });
        }
    }
    checkNumber(field) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        try {
            let pn = parseInt(this.dataTransformed[field], 10);
            if (typeof pn !== 'number' || typeof this.dataTransformed[field] !== 'number') {
                this.addError(field, 'number', { field: field });
            }
            return;
        }
        catch (e) {
            console.log('not number passed to request');
            this.addError(field, 'number', { field: field });
            return;
        }
    }
    checkString(field) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (typeof this.dataTransformed[field] !== 'string') {
            this.addError(field, 'string', { field: field });
        }
    }
    checkDate(field) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (!this.isValidDate(this.dataTransformed[field])) {
            this.addError(field, 'date', { field: field });
        }
    }
    checkNullable(field) {
    }
    checkRegex(field, pattern) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        if (!this.dataTransformed[field]) {
            return;
        }
        const found = this.dataTransformed[field].match(pattern);
        if (!found) {
            this.addError(field, 'regex', { field: field });
        }
    }
    checkRequiredIfNot(field, dependFields) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        for (const dependField of dependFields) {
            if (!this.dataTransformed[dependField]) {
                if (!this.dataTransformed[field]) {
                    this.addError(field, 'requiredIfNot', { field: field, dependField: dependField });
                }
            }
        }
    }
    checkRequiredIf(field, dependFields) {
        if (this.fieldIsEmpty(field)) {
            return;
        }
        for (const dependField of dependFields) {
            if (this.dataTransformed[dependField]) {
                if (!this.dataTransformed[dependField]) {
                    this.addError(field, 'requiredIf', { field: field, dependField: dependField });
                }
            }
        }
    }
    isValidDate(date) {
        const matches = /^(\d{1,2})[-\/](\d{1,2})[-\/](\d{4})$/.exec(date);
        if (matches == null) {
            return false;
        }
        const d = parseInt(matches[2], 10);
        const m = parseInt(matches[1], 10) - 1;
        const y = parseInt(matches[3], 10);
        const composedDate = new Date(y, m, d);
        return composedDate.getDate() == d &&
            composedDate.getMonth() == m &&
            composedDate.getFullYear() == y;
    }
    capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    getMessage(checkType, data) {
        console.log('checkType', checkType);
        let letter = DICT[this.lang || 'en'][checkType];
        Object.keys(data).forEach(key => {
            try {
                letter = letter.replace(`:${key}`, key === 'list' ? data[key] : FIELD_LIST_DICT[this.lang || 'en'][data.field]);
            }
            catch (e) {
                console.log('Error while parsing error message', e);
            }
        });
        return letter;
    }
}
exports.Validator = Validator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvcGVzaGtvdi9kZXYvcHJvamVjdHMvYmxvY2tjaGFpbi0yZmEtYmFja2VuZC9zcmMvc2VydmljZXMvaGVscGVycy92YWxpZGF0aW9uLmhlbHBlci50cyIsInNvdXJjZXMiOlsiL2hvbWUvcGVzaGtvdi9kZXYvcHJvamVjdHMvYmxvY2tjaGFpbi0yZmEtYmFja2VuZC9zcmMvc2VydmljZXMvaGVscGVycy92YWxpZGF0aW9uLmhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDBDQUEyQztBQUUzQyxNQUFNLElBQUksR0FBRztJQUNULEVBQUUsRUFBRTtRQUNBLFFBQVEsRUFBRSwrQkFBK0I7UUFDekMsTUFBTSxFQUFFLG9DQUFvQztRQUM1QyxNQUFNLEVBQUUsb0NBQW9DO1FBQzVDLE9BQU8sRUFBRSxxQ0FBcUM7UUFDOUMsRUFBRSxFQUFFLDZDQUE2QztRQUNqRCxlQUFlLEVBQUUsNkNBQTZDO1FBQzlELGVBQWUsRUFBRSx1REFBdUQ7UUFDeEUsU0FBUyxFQUFFLDZDQUE2QztRQUN4RCxJQUFJLEVBQUUsK0NBQStDO1FBQ3JELEtBQUssRUFBRSwrQkFBK0I7UUFDdEMsVUFBVSxFQUFFLDhEQUE4RDtRQUMxRSxhQUFhLEVBQUUsMERBQTBEO0tBQzVFO0lBQ0QsRUFBRSxFQUFFO1FBQ0EsUUFBUSxFQUFFLHlDQUF5QztRQUNuRCxNQUFNLEVBQUUsaUNBQWlDO1FBQ3pDLE1BQU0sRUFBRSxrQ0FBa0M7UUFDMUMsT0FBTyxFQUFFLHlDQUF5QztRQUNsRCxFQUFFLEVBQUUsNkNBQTZDO1FBQ2pELGVBQWUsRUFBRSxnREFBZ0Q7UUFDakUsZUFBZSxFQUFFLHlDQUF5QztRQUMxRCxTQUFTLEVBQUUseUNBQXlDO1FBQ3BELElBQUksRUFBRSx1QkFBdUI7UUFDN0IsS0FBSyxFQUFFLGdDQUFnQztRQUN2QyxVQUFVLEVBQUUsNERBQTREO1FBQ3hFLGFBQWEsRUFBRSx5REFBeUQ7S0FDM0U7Q0FDSixDQUFDO0FBRUYsTUFBTSxlQUFlLEdBQUc7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QUFJLENBQUM7WUFDNUIsWUFBWSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU8scUJBQXFCLENBQUMsTUFBTTtRQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFTTyxVQUFVLENBQUMsU0FBNkIsRUFBRSxJQUFTO1FBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3BDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWhELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzVCLElBQUksQ0FBQztnQkFDRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRSxFQUFFLEdBQUcsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDcEgsQ0FBQztZQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN4RCxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FDSjtBQXZSRCw4QkF1UkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyAgY2hhbmdlQ2FzZSBmcm9tICdjaGFuZ2UtY2FzZSc7XG5cbmNvbnN0IERJQ1QgPSB7XG4gICAgZW46IHtcbiAgICAgICAgcmVxdWlyZWQ6ICdUaGUgZmllbGQgOmZpZWxkIGlzIHJlcXVpcmVkLicsXG4gICAgICAgIG51bWJlcjogJ1RoZSBmaWVsZCA6ZmllbGQgbXVzdCBiZSBhIG51bWJlci4nLFxuICAgICAgICBzdHJpbmc6ICdUaGUgZmllbGQgOmZpZWxkIG11c3QgYmUgYSBzdHJpbmcuJyxcbiAgICAgICAgYm9vbGVhbjogJ1RoZSBmaWVsZCA6ZmllbGQgbXVzdCBiZSBhIGJvb2xlYW4uJyxcbiAgICAgICAgaW46ICdUaGUgZmllbGQgOmZpZWxkIG11c3QgYmUgb25lIG9mIHRoZTogOmxpc3QuJyxcbiAgICAgICAgbWF4U3RyaW5nTGVuZ3RoOiAnVGhlIGZpZWxkIDpmaWVsZCBtdXN0IGJlIGxlc3MgdGhhbjogOnZhbHVlLicsXG4gICAgICAgIG1heE51bWJlckxlbmd0aDogJ1RoZSBsZW5ndGggb2YgZmllbGQgOmZpZWxkIG11c3QgYmUgbGVzcyB0aGFuOiA6dmFsdWUuJyxcbiAgICAgICAgbWF4TnVtYmVyOiAnVGhlIGZpZWxkIDpmaWVsZCBtdXN0IGJlIGxlc3MgdGhhbjogOnZhbHVlLicsXG4gICAgICAgIGRhdGU6ICdUaGUgZmllbGQgOmZpZWxkIG11c3QgYmUgYSB2YWxpZCBkYXRlIGZvcm1hdC4nLFxuICAgICAgICByZWdleDogJ1RoZSA6ZmllbGQgZm9ybWF0IGlzIGludmFsaWQuJyxcbiAgICAgICAgcmVxdWlyZWRJZjogJ1RoZSBmaWVsZCA6ZmllbGQgaXMgcmVxdWlyZWQgd2hlbiA6ZGVwZW5kRmllbGQgaXMgbm90IGVtcHR5LicsXG4gICAgICAgIHJlcXVpcmVkSWZOb3Q6ICdUaGUgZmllbGQgOmZpZWxkIGlzIHJlcXVpcmVkIHdoZW4gOmRlcGVuZEZpZWxkIGlzIGVtcHR5LicsXG4gICAgfSxcbiAgICBydToge1xuICAgICAgICByZXF1aXJlZDogJ9Cf0L7Qu9C1IDpmaWVsZCDQvtCx0Y/Qt9Cw0YLQtdC70YzQvdC+INC00LvRjyDQt9Cw0L/QvtC70L3QtdC90LjRjy4nLFxuICAgICAgICBudW1iZXI6ICfQn9C+0LvQtSA6ZmllbGQg0LTQvtC70LbQvdC+INCx0YvRgtGMINGH0LjRgdC70L7QvC4nLFxuICAgICAgICBzdHJpbmc6ICfQn9C+0LvQtSA6ZmllbGQg0LTQvtC70LbQvdC+INCx0YvRgtGMINGB0YLRgNC+0LrQvtC5LicsXG4gICAgICAgIGJvb2xlYW46ICfQn9C+0LvQtSA6ZmllbGQg0LTQvtC70LbQvdC+INCx0YvRgtGMIHRydWUg0LjQu9C4IGZhbHNlLicsXG4gICAgICAgIGluOiAn0J/QvtC70LUgOmZpZWxkINC00L7Qu9C20L3QviDQstGF0L7QtNC40YLRjCDQsiDRgdC/0LjRgdC+0Lo6IDpsaXN0LicsXG4gICAgICAgIG1heFN0cmluZ0xlbmd0aDogJ9Cf0L7Qu9C1IDpmaWVsZCDQtNC+0LvQttC90L4g0YHQvtC00LXRgNC00LbQsNGC0YwgOnZhbHVlINGB0LjQvNCy0L7Qu9C+0LIuJyxcbiAgICAgICAgbWF4TnVtYmVyTGVuZ3RoOiAn0KfQuNGB0LvQviA6ZmllbGQg0LTQvtC70LbQvdC+INCx0YvRgtGMINC80LXQvdGM0YjQtSA6dmFsdWUuJyxcbiAgICAgICAgbWF4TnVtYmVyOiAn0KfQuNGB0LvQviA6ZmllbGQg0LTQvtC70LbQvdC+INCx0YvRgtGMINC80LXQvdGM0YjQtSA6dmFsdWUuJyxcbiAgICAgICAgZGF0ZTogJ9Cd0LXQstC10YDQvdGL0Lkg0YTQvtGA0LzQsNGCINC00LDRgtGLLicsXG4gICAgICAgIHJlZ2V4OiAn0J/QvtC70LUgOmZpZWxkINC90LXQstC10YDQvdC+0LPQviDRhNC+0YDQvNCw0YLQsC4nLFxuICAgICAgICByZXF1aXJlZElmOiAn0J/QvtC70LUgOmZpZWxkINC+0LHRj9C30LDRgtC10LvRjNC90L4sINC10YHQu9C4INC90LUg0L/Rg9GB0YLQvtC1INC/0L7Qu9C1IDpkZXBlbmRGaWVsZC4nLFxuICAgICAgICByZXF1aXJlZElmTm90OiAn0J/QvtC70LUgOmZpZWxkINC+0LHRj9C30LDRgtC10LvRjNC90L4sINC10YHQu9C4INC/0YPRgdGC0L7QtSDQv9C+0LvQtSA6ZGVwZW5kRmllbGQuJyxcbiAgICB9LFxufTtcblxuY29uc3QgRklFTERfTElTVF9ESUNUID0ge1xuICAgIHJ1OiB7XG4gICAgICAgIHBob25lX251bWJlcjogYCfQndC+0LzQtdGAINGC0LXQu9C10YTQvtC90LAnYCxcbiAgICAgICAgaW5kZXg6IGAn0JjQvdC00LXQutGBJ2AsXG4gICAgICAgIGV2ZW50OiBgJ9Ch0L7QsdGL0YLQuNC1J2AsXG4gICAgICAgIHNlcnZpY2U6IGAnJ9Ch0LXRgNCy0LjRgWAsXG4gICAgICAgIHB1c2hfdG9rZW46IGAn0J/Rg9GIINGC0L7QutC10L0nYCxcbiAgICAgICAgZW1iZWRlZDogYCfQktGB0YLRgNC+0LXQvdC90L7QtSDRg9GB0YLRgNC+0LnRgdGC0LLQvidgLFxuICAgICAgICBjbGllbnRfdGltZXN0YW1wOiBgJ9CU0LDRgtCwINC4INCy0YDQtdC80Y8g0LrQu9C40LXQvdGC0LAnYCxcbiAgICAgICAgY2VydDogYCfQodC10YDRgtC40YTQuNC60LDRgidgLFxuICAgICAgICBuYW1lOiBgJ9CY0LzRjydgLFxuICAgICAgICB1aW46IGAn0JjQmNCdJ2AsXG4gICAgICAgIGNvZGU6IGAn0JrQvtC0J2AsXG4gICAgICAgIHNleDogYCfQn9C+0LsnYCxcbiAgICAgICAgZW1haWw6IGAn0K3Qu9C10LrRgtGA0L7QvdC90LDRjyDQv9C+0YfRgtCwJ2AsXG4gICAgICAgIGJpcnRoZGF0ZTogYCfQlNC10L3RjCDRgNC+0LbQtNC10L3QuNGPJ2AsXG4gICAgICAgIFJlZ2lvbjogYCfQoNC10LPQuNC+0L0nYCxcbiAgICAgICAgcGVyc29uYWxfYWNjb3VudDogYCfQm9C40YbQtdCy0L7QuSDRgdGH0LXRgidgLFxuICAgICAgICBxdWVzdGlvbjogYCfQktC+0L/RgNC+0YEnYCxcbiAgICAgICAgYW5zd2VyOiBgJ9Ce0YLQstC10YInYCxcbiAgICAgICAgYWRkaXRpb25hbF9kYXRhOiBgJ9CU0L7Qv9C+0LvQvdC40YLQtdC70YzQvdCw0Y8g0LjQvdGE0L7RgNC80LDRhtC40Y8nYCxcbiAgICAgICAgcmVnaW9uOiBgJ9Cg0LXQs9C40L7QvSdgLFxuICAgICAgICBtZXRob2Q6IGAn0JzQtdGC0L7QtCdgLFxuICAgIH0sXG4gICAgZW46IHtcbiAgICAgICAgcGhvbmVfbnVtYmVyOiBgJ1Bob25lIG51bWJlcidgLFxuICAgICAgICBpbmRleDogYCdJbmRleCdgLFxuICAgICAgICBldmVudDogYCdFdmVudCdgLFxuICAgICAgICBzZXJ2aWNlOiBgJydTZXJ2aWNlYCxcbiAgICAgICAgcHVzaF90b2tlbjogYCdQdXNoIHRva2VuJ2AsXG4gICAgICAgIGVtYmVkZWQ6IGAnRW1iZWRlZCdgLFxuICAgICAgICBjbGllbnRfdGltZXN0YW1wOiBgJ0NsaWVudCB0aW1lc3RhbXAnYCxcbiAgICAgICAgY2VydDogYCdDZXJ0aWZpY2F0ZSdgLFxuICAgICAgICBuYW1lOiBgJ05hbWUnYCxcbiAgICAgICAgdWluOiBgJ1VpbidgLFxuICAgICAgICBjb2RlOiBgJ0NvZGUnYCxcbiAgICAgICAgc2V4OiBgJ1NleCdgLFxuICAgICAgICBlbWFpbDogYCdFbWFpbCdgLFxuICAgICAgICBiaXJ0aGRhdGU6IGAnQmlydGhkYXRlJ2AsXG4gICAgICAgIFJlZ2lvbjogYCdSZWdpb24nYCxcbiAgICAgICAgcGVyc29uYWxfYWNjb3VudDogYCdQZXJzb25hbCBhY2NvdW50J2AsXG4gICAgICAgIHF1ZXN0aW9uOiBgJ1F1ZXN0aW9uJ2AsXG4gICAgICAgIGFuc3dlcjogYCdBbnN3ZXInYCxcbiAgICAgICAgYWRkaXRpb25hbF9kYXRhOiBgJ0FkZGl0aW9uYWwgZGF0YSdgLFxuICAgICAgICBtZXRob2Q6IGAnTWV0aG9kJ2AsXG4gICAgICAgIHJlZ2lvbjogYCdSZWdpb24nYCxcbiAgICAgICAgcmVtZW1iZXI6IGAnUmVtZW1iZXInYCxcbiAgICB9LFxufTtcblxuLyoqKlxuICogVmFsaWRhdG9yIGNsYXNzXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWxpZGF0b3Ige1xuXG4gICAgcHJpdmF0ZSBlcnJvcnMgPSB7fTtcbiAgICBwcml2YXRlIGRhdGFUcmFuc2Zvcm1lZCA9IHt9O1xuICAgIHByaXZhdGUgUlVMRV9WQUxVRV9ERUxJTUlURVIgPSAnLCc7XG4gICAgcHJpdmF0ZSBSVUxFX1ZFUlNVU19WQUxVRV9ERUxJTUlURVIgPSAnOic7XG4gICAgcHJpdmF0ZSBsYW5nID0gJ2VuJztcbiAgICBwcml2YXRlIFJVTEVTX0RFTElNSVRFUiA9ICd8JztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YT86IGFueSwgcHJpdmF0ZSBydWxlcz86IGFueSwgcHJpdmF0ZSBtZXNzYWdlcz86IGFueSkge1xuICAgICAgICBjb25zdCBmaWVsZHNUb0hhbmRsZSA9IE9iamVjdC5rZXlzKHRoaXMuZGF0YSk7XG4gICAgICAgIGZvciAobGV0IGYgb2YgZmllbGRzVG9IYW5kbGUpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YVRyYW5zZm9ybWVkW2NoYW5nZUNhc2Uuc25ha2VDYXNlKGYpXSA9IHRoaXMuZGF0YVtmXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChbJ3J1JywgJ2VuJ10uaW5kZXhPZih0aGlzLmRhdGEubGFuZykgIT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmxhbmcgPSB0aGlzLmRhdGEubGFuZyB8fCAnZW4nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYW5nID0gJ2VuJztcbiAgICAgICAgfVxuXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMucnVsZXMpLmZvckVhY2goZmllbGROYW1lVG9DaGVjayA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZFJ1bGVzID0gdGhpcy5ydWxlc1tmaWVsZE5hbWVUb0NoZWNrXS5zcGxpdCh0aGlzLlJVTEVTX0RFTElNSVRFUik7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgZmllbGRSdWxlcykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzcGxpdHRlZCA9IHJ1bGUuc3BsaXQodGhpcy5SVUxFX1ZFUlNVU19WQUxVRV9ERUxJTUlURVIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlZ2V4XG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHRlZC5sZW5ndGggJiYgc3BsaXR0ZWRbMF0gPT09ICdyZWdleCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tSZWdleChmaWVsZE5hbWVUb0NoZWNrLCBuZXcgUmVnRXhwKHNwbGl0dGVkWzFdLnNsaWNlKDEsIC0xKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBpbiwgbWF4IGxlbmdodCwgZGF0ZSwgcmVxdWlyZWRJZk5vdFxuICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXR0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jTmFtZSA9IHRoaXMuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHNwbGl0dGVkLnNoaWZ0KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2BjaGVjayR7ZnVuY05hbWV9YF0oZmllbGROYW1lVG9DaGVjaywgc3BsaXR0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhgVmFsaWRhdG9yQGNvbnN0cnVjdG9yOiB2YWxpZGF0aW9uIGVycm9yIGZ1bmNOYW1lIGAsIGZ1bmNOYW1lLCBmaWVsZE5hbWVUb0NoZWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWlyZWQuIG51bWJlciwgc3RyaW5nLCBudWxsYWJsZVxuICAgICAgICAgICAgICAgICAgICB0aGlzWydjaGVjaycgKyB0aGlzLmNhcGl0YWxpemVGaXJzdExldHRlcihzcGxpdHRlZFswXSldKGZpZWxkTmFtZVRvQ2hlY2spO1xuXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYFZhbGlkYXRvckBjb25zdHJ1Y3RvcjogdmFsaWRhdGlvbiB0eXBlIGlzIG5vdCBzdXBwb3J0ZWRgLCBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldEVycm9ycygpOiBhbnkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnM7XG4gICAgfVxuXG4gICAgaXNFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuZXJyb3JzKS5sZW5ndGggPT09IDA7XG4gICAgfVxuXG4gICAgZmFpbHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5pc0VtcHR5KCk7XG4gICAgfVxuXG4gICAgYWRkRXJyb3IoZmllbGROYW1lOiBzdHJpbmcsIGNoZWNrVHlwZT86IHN0cmluZywgZGF0YT86IGFueSk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuZXJyb3JzW2ZpZWxkTmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzW2ZpZWxkTmFtZV0gPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjaGVja01lc3NhZ2U7XG4gICAgICAgIGlmIChjaGVja1R5cGUgJiYgdGhpcy5tZXNzYWdlcykge1xuICAgICAgICAgICAgY2hlY2tNZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tgJHtmaWVsZE5hbWV9LiR7Y2hlY2tUeXBlfWBdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lcnJvcnNbZmllbGROYW1lXS5wdXNoKGNoZWNrTWVzc2FnZSB8fCB0aGlzLmdldE1lc3NhZ2UoY2hlY2tUeXBlLCBkYXRhKSk7XG4gICAgfVxuXG4gICAgLy8gbm9pbnNwZWN0aW9uIFRzTGludFxuICAgIHByaXZhdGUgY2hlY2tSZXF1aXJlZChmaWVsZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhVHJhbnNmb3JtZWRbZmllbGRdIHx8IHRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSA9PT0gJycpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZmllbGQsICdyZXF1aXJlZCcsIHtmaWVsZDogZmllbGR9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIG5vaW5zcGVjdGlvbiBUc0xpbnRcbiAgICBwcml2YXRlIGNoZWNrQm9vbGVhbihmaWVsZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkSXNFbXB0eShmaWVsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YodGhpcy5kYXRhVHJhbnNmb3JtZWRbZmllbGRdKSAhPT0gdHlwZW9mKHRydWUpKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKGZpZWxkLCAnYm9vbGVhbicsIHtmaWVsZDogZmllbGR9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZmllbGRJc0VtcHR5KGZpZWxkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSA9PT0gJyc7XG4gICAgfVxuXG4gICAgLy8gbm9pbnNwZWN0aW9uIFRzTGludFxuICAgIHByaXZhdGUgY2hlY2tJbihmaWVsZDogc3RyaW5nLCBsaXN0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZmllbGRJc0VtcHR5KGZpZWxkKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpc3RbMF0uc3BsaXQodGhpcy5SVUxFX1ZBTFVFX0RFTElNSVRFUikuaW5kZXhPZih0aGlzLmRhdGFUcmFuc2Zvcm1lZFtmaWVsZF0pID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5hZGRFcnJvcihmaWVsZCwgJ2luJywge2ZpZWxkOiBmaWVsZCwgbGlzdDogbGlzdH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gbm9pbnNwZWN0aW9uIFRzTGludFxuICAgIHByaXZhdGUgY2hlY2tNYXhTdHJpbmdMZW5ndGgoZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5maWVsZElzRW1wdHkoZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kYXRhVHJhbnNmb3JtZWRbZmllbGRdLmxlbmd0aCA+PSBwYXJzZUludCh2YWx1ZSwgMTApKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKGZpZWxkLCAnbWF4U3RyaW5nTGVuZ3RoJywge2ZpZWxkOiBmaWVsZCwgdmFsdWU6IHZhbHVlfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBub2luc3BlY3Rpb24gVHNMaW50XG4gICAgcHJpdmF0ZSBjaGVja01heE51bWJlcihmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkSXNFbXB0eShmaWVsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJzZUludCh0aGlzLmRhdGFUcmFuc2Zvcm1lZFtmaWVsZF0sIDEwKSA+PSBwYXJzZUludCh2YWx1ZVswXSwgMTApKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKGZpZWxkLCAnbWF4TnVtYmVyJywge2ZpZWxkOiBmaWVsZCwgdmFsdWU6IHZhbHVlfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBub2luc3BlY3Rpb24gVHNMaW50XG4gICAgcHJpdmF0ZSBjaGVja01heE51bWJlckxlbmd0aChmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkSXNFbXB0eShmaWVsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChgJHt0aGlzLmRhdGFUcmFuc2Zvcm1lZFtmaWVsZF19YC5sZW5ndGggPj0gcGFyc2VJbnQodmFsdWVbMF0sIDEwKSkge1xuICAgICAgICAgICAgdGhpcy5hZGRFcnJvcihmaWVsZCwgJ21heE51bWJlckxlbmd0aCcsIHtmaWVsZDogZmllbGQsIHZhbHVlOiB2YWx1ZX0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gbm9pbnNwZWN0aW9uIFRzTGludFxuICAgIHByaXZhdGUgY2hlY2tOdW1iZXIoZmllbGQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5maWVsZElzRW1wdHkoZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHBuID0gcGFyc2VJbnQodGhpcy5kYXRhVHJhbnNmb3JtZWRbZmllbGRdLCAxMCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgcG4gIT09ICdudW1iZXInIHx8IHR5cGVvZiB0aGlzLmRhdGFUcmFuc2Zvcm1lZFtmaWVsZF0gIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRFcnJvcihmaWVsZCwgJ251bWJlcicsIHtmaWVsZDogZmllbGR9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ25vdCBudW1iZXIgcGFzc2VkIHRvIHJlcXVlc3QnKTtcbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZmllbGQsICdudW1iZXInLCB7ZmllbGQ6IGZpZWxkfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgLy8gbm9pbnNwZWN0aW9uIFRzTGludFxuICAgIHByaXZhdGUgY2hlY2tTdHJpbmcoZmllbGQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5maWVsZElzRW1wdHkoZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZmllbGQsICdzdHJpbmcnLCB7ZmllbGQ6IGZpZWxkfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB0b2RvIGFkZCBmb3JtYXQgY2hlY2tpbmdcbiAgICAvLyBub2luc3BlY3Rpb24gVHNMaW50XG4gICAgcHJpdmF0ZSBjaGVja0RhdGUoZmllbGQ6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5maWVsZElzRW1wdHkoZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZERhdGUodGhpcy5kYXRhVHJhbnNmb3JtZWRbZmllbGRdKSkge1xuICAgICAgICAgICAgdGhpcy5hZGRFcnJvcihmaWVsZCwgJ2RhdGUnLCB7ZmllbGQ6IGZpZWxkfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBub2luc3BlY3Rpb24gVHNMaW50XG4gICAgcHJpdmF0ZSBjaGVja051bGxhYmxlKGZpZWxkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgLy8gdG9kbyBzb21lIGFjdGlvbiBtYXkgYmVcbiAgICB9XG5cbiAgICAvLyBub2luc3BlY3Rpb24gVHNMaW50XG4gICAgcHJpdmF0ZSBjaGVja1JlZ2V4KGZpZWxkOiBzdHJpbmcsIHBhdHRlcm46IFJlZ0V4cCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5maWVsZElzRW1wdHkoZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZm91bmQgPSB0aGlzLmRhdGFUcmFuc2Zvcm1lZFtmaWVsZF0ubWF0Y2gocGF0dGVybik7XG4gICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZmllbGQsICdyZWdleCcsIHtmaWVsZDogZmllbGR9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIG5vaW5zcGVjdGlvbiBUc0xpbnRcbiAgICBwcml2YXRlIGNoZWNrUmVxdWlyZWRJZk5vdChmaWVsZDogc3RyaW5nLCBkZXBlbmRGaWVsZHM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkSXNFbXB0eShmaWVsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoY29uc3QgZGVwZW5kRmllbGQgb2YgIGRlcGVuZEZpZWxkcykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGFUcmFuc2Zvcm1lZFtkZXBlbmRGaWVsZF0pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGF0YVRyYW5zZm9ybWVkW2ZpZWxkXSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVycm9yKGZpZWxkLCAncmVxdWlyZWRJZk5vdCcsIHtmaWVsZDogZmllbGQsIGRlcGVuZEZpZWxkOiBkZXBlbmRGaWVsZH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIG5vaW5zcGVjdGlvbiBUc0xpbnRcbiAgICBwcml2YXRlIGNoZWNrUmVxdWlyZWRJZihmaWVsZDogc3RyaW5nLCBkZXBlbmRGaWVsZHM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkSXNFbXB0eShmaWVsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoY29uc3QgZGVwZW5kRmllbGQgb2YgIGRlcGVuZEZpZWxkcykge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YVRyYW5zZm9ybWVkW2RlcGVuZEZpZWxkXSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kYXRhVHJhbnNmb3JtZWRbZGVwZW5kRmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZmllbGQsICdyZXF1aXJlZElmJywge2ZpZWxkOiBmaWVsZCwgZGVwZW5kRmllbGQ6IGRlcGVuZEZpZWxkfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkRGF0ZShkYXRlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IC9eKFxcZHsxLDJ9KVstXFwvXShcXGR7MSwyfSlbLVxcL10oXFxkezR9KSQvLmV4ZWMoZGF0ZSk7XG4gICAgICAgIGlmIChtYXRjaGVzID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkID0gcGFyc2VJbnQobWF0Y2hlc1syXSwgMTApO1xuICAgICAgICBjb25zdCBtID0gcGFyc2VJbnQobWF0Y2hlc1sxXSwgMTApIC0gMTtcbiAgICAgICAgY29uc3QgeSA9IHBhcnNlSW50KG1hdGNoZXNbM10sIDEwKTtcbiAgICAgICAgY29uc3QgY29tcG9zZWREYXRlID0gbmV3IERhdGUoeSwgbSwgZCk7XG4gICAgICAgIHJldHVybiBjb21wb3NlZERhdGUuZ2V0RGF0ZSgpID09IGQgJiZcbiAgICAgICAgICAgIGNvbXBvc2VkRGF0ZS5nZXRNb250aCgpID09IG0gJiZcbiAgICAgICAgICAgIGNvbXBvc2VkRGF0ZS5nZXRGdWxsWWVhcigpID09IHk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZ2V0IG1lc3NhZ2UgZnJvbSBkaWN0aW9uYXJ5XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZyB8IHVuZGVmaW5lZH0gY2hlY2tUeXBlXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0TWVzc2FnZShjaGVja1R5cGU6IHN0cmluZyB8IHVuZGVmaW5lZCwgZGF0YTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrVHlwZScsIGNoZWNrVHlwZSk7XG4gICAgICAgIGxldCBsZXR0ZXIgPSBESUNUW3RoaXMubGFuZyB8fCAnZW4nXVtjaGVja1R5cGVdO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbGV0dGVyID0gbGV0dGVyLnJlcGxhY2UoYDoke2tleX1gLCBrZXkgPT09ICdsaXN0JyA/IGRhdGFba2V5XSA6IEZJRUxEX0xJU1RfRElDVFt0aGlzLmxhbmcgfHwgJ2VuJ11bZGF0YS5maWVsZF0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciB3aGlsZSBwYXJzaW5nIGVycm9yIG1lc3NhZ2UnLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBsZXR0ZXI7XG4gICAgfVxufVxuIl19